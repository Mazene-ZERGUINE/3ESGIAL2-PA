<div class="col">
  <h1 class="my-3">{{ isEditPage ? 'Edition ' : 'Ajout ' }} de publication {{ !isPostBanned ? '' : '(modérée)' }}</h1>
  <form
    enctype="multipart/form-data"
    class="border border-secondary border-opacity-50 rounded p-3"
    [formGroup]="form"
    (ngSubmit)="onSubmit()"
    *ngIf="form"
  >
    <div class="mb-3">
      <label class="form-label required" for="titre">Titre</label>
      <input class="form-control" type="text" id="titre" name="titre" formControlName="titre" required autofocus />
      <div
        class="text-danger my-2"
        *ngIf="form.get('titre')?.touched && form.get('titre')?.dirty && form.get('titre')?.getError('titre')"
      >
        Le champs doit contenir un titre.
      </div>
    </div>
    <div class="mb-3">
      <label class="form-label" for="description">Description</label>
      <input class="form-control" type="text" id="description" name="description" formControlName="description" />
    </div>
    <div class="mb-3">
      <label class="form-label required" for="categorie">Catégorie</label>
      <select class="form-select" formControlName="categorie" id="categorie" aria-label="Sélection de catégorie">
        <option *ngFor="let categorie of categories" [value]="categorie.categorie_id">
          {{ categorie.libelle }}
        </option>
      </select>
      <small
        class="text-danger my-2"
        *ngIf="
          form.get('departement')?.touched &&
          form.get('departement')?.dirty &&
          form.get('departement')?.getError('pattern')
        "
      >
        Le champ est incorrect.
      </small>
    </div>
    <div class="mb-3">
      <label class="form-label" for="images">Ajouter une image</label>
      <div>
        <input
          class="form-control"
          type="file"
          name="images"
          id="images"
          [accept]="acceptedTypes"
          (change)="onFileInputChange($event)"
        />
      </div>
    </div>
    <ul class="list-group mb-3">
      <li class="list-group-item d-flex justify-content-between" *ngFor="let image of $any(images)">
        {{ image.name }}
        <button class="btn btn-outline-danger" [disabled]="isPostBanned" (click)="onDelete(image)">
          <i class="bi bi-trash-fill"></i>
        </button>
      </li>
    </ul>
    <div class="mb-3" *ngIf="isEditPage">
      <label class="form-label required" for="statut">Statut</label>
      <select class="form-select" formControlName="statut" id="statut" aria-label="Sélection de statut">
        <ng-container *ngFor="let status of statuses">
          <option [value]="status" *ngIf="status !== 'banni'">
            {{ status }}
          </option>
          <option [value]="status" *ngIf="status === 'banni' && decodedToken?.role === role.admin">
            {{ status }}
          </option>
        </ng-container>
      </select>
      <small
        class="text-danger my-2"
        *ngIf="form.get('statut')?.touched && form.get('statut')?.dirty && form.get('statut')?.getError('pattern')"
      >
        Le champ est incorrect.
      </small>
    </div>
    <button
      [ngClass]="isEditPage ? 'btn btn-outline-warning' : 'btn btn-outline-success'"
      [disabled]="form.invalid || isPostBanned"
    >
      {{ isEditPage ? 'Editer' : 'Ajouter' }}
    </button>
  </form>
</div>
